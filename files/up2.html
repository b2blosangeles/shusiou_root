<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/fileUpload2.js"></script>
<script src="/js/DropBox.js"></script>
<title>Drag and drop, automatic upload</title>
<style>
#holder { border: 10px dashed #ccc; width: 300px; min-height: 300px; margin: 20px auto;}
#holder.hover { border: 10px dashed #0c0; }
#holder img { display: block; margin: 10px auto; }
#holder p { margin: 10px; font-size: 14px; }
progress { width: 100%; }
progress:after { content: '%'; }
.fail { background: #c00; padding: 2px; color: #fff; }
//.hidden { display: none !important;}
</style>
<script>

     var uploadResult = {};
     function showResult() {
          str = '';
          for(k in uploadResult) {
               if (uploadResult[k].src) {
                    str += k + ':<img src="' + uploadResult[k].src + '" width="300" /><br/>';
               } else {
                    str += k + ' Completed: ' + uploadResult[k].perc + '%<br>';
               }
          }
          $('#upload_result' ).html(str);
     }   

     function showMatrix(v) {
          str = '';
          for(k in v) {
               if (v[k] === 'D') {
                    str += '*';
               } else if  (v[k] === '') { 
                    str += '';
               }else {
                    str += '.';
               }
          }
          $('#upload_mitrix' ).html(str);
     } 
 
/*
function readfiles(files) {
  //  debugger;
        var up = [];
         for (var i = 0; i < files.length; i++) {
            up[i] = new FILEUPLOAD(
                {
                    file: files[i],
                    sliceSize : 1024 * 16,
                    threads : 5,
                    progress : function(M, sourceFn, percent_done) {
                         if (!uploadResult[sourceFn]) uploadResult[sourceFn] = {};
                         uploadResult[sourceFn]['perc'] = percent_done;
                         showResult();
                         showMatrix(M);
                         //console.log(me.upload_M);
                    },
                    done : function(M, sourceFn, data) {
                         $("#dbi-file-upload").val('');
                         if (!uploadResult[sourceFn]) uploadResult[sourceFn] = {};
                         uploadResult[sourceFn].src = '/api/sendup.api?fn=' + data.fn + '&nocache=' + new Date().getTime();
                         showResult();
                         showMatrix(M);
                    },
                    error : function() {
                         $('#upload_result' ).html('Upload failure!!!');
                    }

                }
              )
             up[i].upload();
         }
}
*/
$( document ).ready(function() {  
    
    var D = new DropBox({
        submitTrigger : $('#dbi-file-upload-submit')
    });
    D.init();
    console.log('===D23===');   
});  
</script>

  </head>
  <body>
    <article>
  <div id="holder">
  </div> 
  <p id="upload" class="hidden"><label>Drag & drop not supported, but you can still upload via this input field:<br><input type="file"></label></p>
  <p id="filereader">File API & FileReader API not supported</p>
  <p id="formdata">XHR2's FormData is not supported</p>
  <p id="progress">XHR2's upload progress isn't supported</p>
  <p>Upload progress: <progress id="uploadprogress" max="100" value="0">0</progress></p>
  <p>Drag an image from your desktop on to the drop zone above to see the browser both render the preview, but also upload automatically to this server.</p>
</article>
  <br/><hr/>
      <a id="dbi-file-upload-submit" href="Javascript:void(0)">test</a>
      <hr/><br/>
<div id = "upload_result"></div>
<div id = "upload_mitrix"></div>
</body>
</html>
