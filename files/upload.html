<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/fileupload.js"></script>
</head>
<script>
$( document ).ready(function() {
     var completed = {}, uploadResult = {}
     function showComplete() {
          str = '';
          for(k in completed) {
               str += k + ' Completed: ' + completed[k] + '%<br>';
          }
          $('#upload_completed' ).html(str);
     }
     function showResult() {
          str = '';
          for(k in uploadResult) {
               str += k + ':<img src="' + uploadResult[k] + '" width="300" />';
          }
          $('#upload_result' ).html(str);
     }   
     
     $('#dbi-file-upload-submit').on( 'click', function(event) {
         event.preventDefault();
         var files = $('#dbi-file-upload' )[0].files; 
         up = [];
         for (var i = 0; i < files.length; i++) {
            up[i] = new FILEUPLOAD(
                {
                    file: files[i],
                    progress : function(sourceFn, percent_done) {
                         completed[sourceFn] = percent_done;
                         showComplete()
                    },
                    done : function(sourceFn, data) {
                         uploadResult[sourceFn] = '/api/sendup.api?fn=' + data.fn + '&nocache=' + new Date().getTime();
                         showResult();
                    }

                }
              )
             up[i].upload();
         }
     });
     
});
    
</script>
<body>
<form>
   <p id="dbi-upload-progress">Please select a file and click "Upload" to continue.</p>
   <input id="dbi-file-upload" type="file" name="dbi_import_file" multiple /><br><br>
   <input id="dbi-file-upload-submit" class="button button-primary" type="button" value="Upload" />
       
</form>
<br/><hr/><br/>
<div id = "upload_completed"></div>
<div id = "upload_result"></div>
</body>
</html>
