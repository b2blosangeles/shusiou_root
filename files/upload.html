<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<script>
$( document ).ready(function() {
    var reader = {};
    var file = {};
    var slice_size = 100 * 2;

    var img = '';
    
    function start_upload( event ) {
        event.preventDefault();
        reader = new FileReader();
      //  file = $( '#dbi-file-upload' ).files[0];
        file = document.querySelector( '#dbi-file-upload' ).files[0];
        
         
        
        upload_file( 1000 );
    }
    $( '#dbi-file-upload-submit' ).on( 'click', start_upload );
/*
   function joinBase64Strings(base64Str1, base64Str2) {
      const bothData = Buffer.from(base64Str1, 'base64').toString('binary') 
            + Buffer.from(base64Str2, 'base64').toString('binary');
      const joinedBase64Result = Buffer.from(bothData.toString(), 'binary').toString('base64');
      console.log('joinedBase64Result', joinedBase64Result);
      return joinedBase64Result;
    }  
 */   
    function upload_file( start ) {
            var next_slice = start + slice_size + 1;
                   
        
            var blob = file.slice( start, next_slice );
        
        reader.onloadend = function( event ) {
             img = joinBase64Strings(img, event.target.result)
             console.log(img);
            if ( event.target.readyState !== FileReader.DONE ) {
                alert('=AAA=');
                return;
            } else {
                    if ( next_slice < file.size ) { 
                        upload_file( next_slice );
                  } else {
                      console.log('Done!!!');
                  }
                
                // console.log( file.size );
               // console.log('BBB---' + FileReader.DONE);
            }

            // At this point the file data is loaded to event.target.result
        };        
        reader.readAsDataURL( blob );
    }

});

</script>
<body>
<form>
    <p id="dbi-upload-progress">Please select a file and click "Upload" to continue.</p>

    <input id="dbi-file-upload" type="file" name="dbi_import_file" /><br><br>

    <input id="dbi-file-upload-submit" class="button button-primary" type="button" value="Upload" />
</form>
</body>
</html>
